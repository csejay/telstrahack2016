<!DOCTYPE html>
<html>
  <head>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="container-fluid">
      <div id="message" class="panel-group"></div>
    </div>
    <button onClick="callCountry()">Call Country API</button>

    <script>
    var country = "initial value"
    var safetyInfo = ''
    var callCountry = function(){
      $.ajax({
      	type: 'GET',
      	crossDomain: true,
      	dataType : "json",
        headers: { "X-Auth-API-Key": "ckguvyq63hyy79aruyvcnybb" },
        url: "https://api.tugo.com/v1/travelsafe/countries/VN",
      	success: function (data) {
          console.log('Success GET: country')
      		console.log(data);
          country = data
          safetyInfo = country.safety.safetyInfo
          displayCall()
      	}
      });
    }
    var displayCall = function(){
      // empty ('#message')
      $('#message').empty()
      console.log('empty called')
      // set ('#message') with initial div, id=#message0
      $('#message').html('<div id="message0"></div>')
      console.log('initial fill')
      console.log(safetyInfo)
      // append country title before (#message0)
      $('#message0').html(
        '<h3>' +
          country.name +
          '    <img width="50" src="images/flag_vietnam.png" alt="">' +
        '</h3>'
      )

      // for loop, append after ("#message0")
      for(var i=0; i<safetyInfo.length - 1;i++){
        // create new element 'message[i]''
        var prevMessage = 'message' + i
        var curMessage = 'message' + (i + 1)
        $('#' + prevMessage).after('<div id="' + curMessage + '" class="panel panel-default"></div>')


        $('#' + curMessage).html(
            '<div class="panel-heading">' +
              '<h4 data-toggle="collapse" data-parent="#message" data-target="#collapse' + i +'" class="panel-title">' +
                safetyInfo[i].category +
              '</h4>' +
            '</div>' +
            '<div id="collapse' + i + '" class="panel-collapse collapse">' +
              '<div class="panel-body">' +
                safetyInfo[i].description +
              '</div>' +
            '</div>'
        )
        console.log(i)
        console.log(safetyInfo[i])
      }

      // advisory info
      $('#message0').after(
        '<div class="panel panel-warning">' +
          '<div class="panel-heading">' +
            '<h3 class="panel-title">Advisories</h3>' +
          '</div>' +
          '<div class="panel-body">' +
            country.advisories.description +
          '</div>' +
        '</div>'
      )
      console.log(country.advisories.description)
    }
    </script>
  </body>
</html>
